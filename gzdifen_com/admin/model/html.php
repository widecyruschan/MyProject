<?phpout();$top='<div class="page"><div class="pageHeader"><h1  class="title">静态生成</h1></div><div class="pageContent"><div class="html"layoutH="57">';$bottom='</div></div></div>';$type=$_GET['type'];$range=$_GET['range'];$id=verify_id($_GET['id']);$PB_page=verify_id($_GET['PB_page']);if($type=="index"){ob_start( );$indexhtml = 1;include_once( "../index.php");$htmltext = ob_get_contents( );ob_end_clean( );echo $top;echo "\r\n<TABLE width=\"98%\" border=\"1\" align=\"center\"  cellspacing=\"0\" >\r\n        <TR>\r\n          <TD><strong>发布进度</strong></TD>\r\n        </TR>\r\n\t\t<TR>\r\n          <TD height=32 align=\"center\"><div class=\"RefreshLen\"><span class=\"xingmu\" id=\"RefreshLenx\"></span></div></TD>\r\n        </TR>\r\n        <TR>\r\n          <TD height=32 align=\"center\"><span id=\"IndexHtml\"></span></TD>\r\n        </TR>\r\n  </TABLE>\r\n";if ( wfile( "../index.".$web_html_mode,$htmltext ) ){echo "<script type=\"text/javascript\" language=\"javascript\">document.getElementById(\"RefreshLenx\").style.width = \"100%\";document.getElementById(\"RefreshLenx\").innerHTML = \"100%\";document.getElementById(\"IndexHtml\").innerHTML = \"首页生成成功\";</script>";}else{echo "<script type=\"text/javascript\" language=\"javascript\">document.getElementById(\"RefreshLenx\").style.width = \"0%\";document.getElementById(\"RefreshLenx\").innerHTML = \"0%\";document.getElementById(\"IndexHtml\").innerHTML = \"首页生成失败\";</script>";}echo $bottom;}if($type=="columns"){if($_GET['echo']=='ajax'){ob_start( );include_once( "../class.php");$classtext = ob_get_contents( );ob_end_clean( );if ( $PB_page != 1 ){if(stride('subtitle','columns','id',$id)!=""){$classurl = stride('subtitle','columns','id',$id)."_".$PB_page.".".$web_html_mode;}else{$classurl = "class_".$id."_".$PB_page.".".$web_html_mode;}}else{if(stride('subtitle','columns','id',$id)!=""){$classurl = stride('subtitle','columns','id',$id).".".$web_html_mode;}else{$classurl = "class_".$id.".".$web_html_mode;}}wfile( "../".$web_html_dir.$classurl,$classtext );echo ( $_GET['id']."|".( $_GET['PB_page'] + 1 ) )."|".ceil( $intNum / $intPerpage );exit;}echo $top;echo "<script type=\"text/javascript\" src=\"js/ajaxrequest.js\"></script>\r\n<script type=\"text/javascript\" src=\"js/htmljs.js\"></script>\r\n<TABLE width=\"98%\" border=\"1\" align=\"center\"  cellspacing=\"0\"  >\r\n        <TR>\r\n          <TD><strong>发布进度</strong></TD>\r\n        </TR>\r\n\t\t<TR>\r\n          <TD height=32 align=\"center\"><div class=\"RefreshLen\"><span class=\"xingmu\" id=\"RefreshLenx\"></span></div></TD>\r\n        </TR>\r\n        <TR>\r\n          <TD height=32 align=\"center\">总共要生成<span id=\"ClassNum\" style=\"color:#FF0000\"></span>个栏目,已经生成<span id=\"ClassHtmlNum\" style=\"color:#FF0000\">0</span>个栏目,当前生成<span id=\"ClassName\" style=\"color:#FF0000\"></span>栏目,该栏目共有<span id=\"ClassPageNum\" style=\"color:#FF0000\"></span>个分页,已生成<span id=\"ClassPage\" style=\"color:#FF0000\"></span>个分页</TD>\r\n        </TR>\r\n\t\t  </TABLE>\r\n";if ( isset( $_POST['ClassID'] ) ){$chid = implode( ",",$_POST['ClassID'] );$sql = "SELECT * FROM {$DB_dbprefix}columns WHERE id in (".$chid.")";}else{$sql = "SELECT * FROM {$DB_dbprefix}columns";}$resultc = $db->query( $sql );$intNum = mysql_num_rows( $resultc );$i = 0;while ( $db->next_record( ) ){$i += 1;echo "<script language=\"JavaScript\">\r\ndocument.getElementById(\"RefreshLenx\").style.width = (";echo $i / $intNum;echo ")*100+\"%\";\r\ndocument.getElementById(\"RefreshLenx\").innerHTML = (";echo $i / $intNum;echo ")*100+\"%\";\r\ndocument.getElementById(\"ClassName\").innerHTML = \"";echo $db->Record['title'];echo "\";\r\ndocument.getElementById(\"ClassNum\").innerHTML = ";echo $intNum;echo ";\r\ndocument.getElementById(\"ClassHtmlNum\").innerHTML = ";echo $i;echo ";\r\ndocument.getElementById(\"ClassPageNum\").innerHTML = 1;\r\ndocument.getElementById(\"ClassPage\").innerHTML = 1;\r\n\r\nvar Url=\"?model=html&type=columns&echo=ajax&id=";echo $db->Record['id'];echo "&PB_page=1";echo "\";\r\nclasshtml(Url);\r\n</script>\r\n";}echo $bottom;}if($type=="view"){if($_GET['echo']=='ajax'){header( "Content-Type:text/html;charset=utf-8");header( "Expires: Mon, 26 Jul 1997 05:00:00 GMT");header( "Last-Modified: ".gmdate( "D, d M Y H:i:s")." GMT");header( "Cache-Control: no-cache, must-revalidate");header( "Pragma: no-cache");$htmlPHPCMS_array = $_SESSION['htmlPHPCMS_array'];$GLOBALS['_GET']['id'] = $htmlPHPCMS_array[$_GET['PHPCMSHtmlNum']];ob_start( );include_once( "../view.php");$classtext = ob_get_contents( );ob_end_clean( );switch ( $web_html_name ){case 1 :if(stride('subtitle','content','id',$_GET['id'])!=""){$PHPCMSurl = "view_".stride('subtitle','content','id',$_GET['id']).".".$web_html_mode;}else{$PHPCMSurl = "view_".$_GET['id'].".".$web_html_mode;}break;case 2 :$PHPCMSurl = date("Ymdgis",stride('time','content','id',$_GET['id'])).".".$web_html_mode;break;case 3 :if(stride('subtitle','content','id',$_GET['id'])!=""){createfolder( "../".$web_html_dir.stride('subtitle','content','id',$_GET['id']) );$PHPCMSurl = stride('subtitle','content','id',$_GET['id'])."/index.".$web_html_mode;}else{createfolder( "../".$web_html_dir.$_GET['id'] );$PHPCMSurl = $id."/index.".$web_html_mode;}}wfile( "../".$web_html_dir.$PHPCMSurl,$classtext );echo ( $_GET['PHPCMSHtmlNum'] +1 )."|".count( $htmlPHPCMS_array )."|".$_GET['id'];exit;}echo $top;echo "<script type=\"text/javascript\" src=\"js/ajaxrequest.js\"></script>\r\n<script type=\"text/javascript\" src=\"js/htmljs.js\"></script>\r\n<TABLE   cellSpacing=\"0\"  width=\"98%\" align=\"center\" border=\"1\">\r\n      <TBODY>\r\n        <TR>\r\n          <TD>发布进度</TD>\r\n        </TR>\r\n\t\t<TR>\r\n          <TD height=32 align=\"center\"><div class=\"RefreshLen\"><span class=\"xingmu\" id=\"RefreshLenx\"></span></div></TD>\r\n        </TR>\r\n        <TR>\r\n          <TD height=32 align=\"center\">总共要发布<span id=\"PHPCMSNum\"></span>个文档,已经发布<span id=\"PHPCMSHtmlNum\">0</span>个文档</TD>\r\n        </TR>\r\n     </TBODY>\r\n</TABLE>\r\n";$_SESSION['htmlPHPCMS_array'] = "";switch ( $_GET['range'] ){case "all":$sql = "select * from {$DB_dbprefix}content";break;case "translation":if ( function_exists( "date_default_timezone_set") ){date_default_timezone_set( "Hongkong");}$datetime = date( "Y-m-d");$sql = "select * from {$DB_dbprefix}content where from_unixtime(time,'%Y-%m-%d')='".$datetime."'";break;case "new":$sql = "select * from {$DB_dbprefix}content order by time desc limit 0,".$_POST['NewNum'].";";break;case "id":$sql = "select * from {$DB_dbprefix}content where id>=".$_POST['StopID']." and id<={$_POST['EndID']}";break;case "date":$sql = "select * from {$DB_dbprefix}content where from_unixtime(time,'%Y-%m-%d') between '".$_POST['StopDate']."' and '{$_POST['EndDate']}'";break;case "cid":if($_POST['ClassID']){$chid = implode( ",",$_POST['ClassID'] );$sql = "select * from {$DB_dbprefix}content where cid in (".$chid.")";}else{	$sql = "select * from {$DB_dbprefix}content";}}$resultc = $db->query( $sql );while ( $db->next_record( ) ){$htmlPHPCMSid[] = $db->Record['id'];$subtitle[] = $db->Record['subtitle'];}$_SESSION['htmlPHPCMS_array'] = $htmlPHPCMSid;echo "<script language=\"JavaScript\">\r\nPHPCMSHtml(0);\r\n</script>\r\n";}?>