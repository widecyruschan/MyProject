<?phpout();$id=verify_id($_GET['id']);$title=str_check($_POST['title']);$bid=verify_id($_POST['bid']);$subtitle=str_check($_POST['subtitle']);$hide=verify_id($_POST['hide']);$module=str_check($_POST['module']);$templates=str_check($_POST['templates']);$description=str_check($_POST['description']);$keywords=str_check($_POST['keywords']);$permute=verify_id($_POST['permute']);if($action=='edit'){$db->query("SELECT * FROM  `{$DB_dbprefix}columns` WHERE `id` != '$id' AND  `subtitle` =  '$subtitle' AND `subtitle` !=  '' LIMIT 0 , 1");if ( !$db->next_record( ) ){$db->query( "UPDATE {$DB_dbprefix}columns SET id='{$id}',title='{$title}',bid='{$bid}',subtitle='{$subtitle}',hide='{$hide}',module='{$module}',templates='{$templates}',description='{$description}',keywords='{$keywords}',permute='{$permute}',time='".time()."'  WHERE id={$id}");addlog( "修改".$id."栏目",$_SESSION['admin_user'] );done('操作成功,请刷新后台','navNewsLi','closeCurrent');}else{fail('检测到有相同的保存名，请修改后再次提交');}}if($action=='del'){$db->query("SELECT * FROM  `{$DB_dbprefix}content` WHERE  `cid` ={$id} LIMIT 1");if ( !$db->next_record( ) ){$db->query( "DELETE FROM {$DB_dbprefix}columns WHERE id={$id}; ");addlog( "删除栏目$id",$_SESSION['admin_user']);done('删除成功','','');}else{fail('栏目下有内容，无法删除');}}if($action=='add'){$db->query("SELECT * FROM  `{$DB_dbprefix}columns` WHERE  `subtitle` =  '$subtitle' AND `subtitle` !=  '' LIMIT 0 , 1");if ( !$db->next_record( ) ){$db->query( "INSERT INTO `{$DB_dbprefix}columns` (`id`, `title`, `bid`, `subtitle`, `hide`, `module`, `templates`, `description`, `keywords`, `permute`, `time`) VALUES (NULL, '$title', '$bid', '$subtitle', '$hide', '$module', '$templates', '$description', '$keywords', '$permute', '".time()."');");addlog( "添加栏目",$_SESSION['admin_user'] );done('操作成功,请刷新后台','navNewsLi','closeCurrent');}else{fail('检测到有相同的保存名，请修改后再次提交');}exit();}?>