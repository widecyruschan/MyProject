<?phprequire_once(dirname(__FILE__).'/inc/include/header.php');$MYCMS->caching = false; if(is_array($_POST['cart'])){	count($_POST['number']) > 30 && msgbox($language['page']['malicious'],'cart.php');	if(true === USER_LOGIN){		$pid = $number = $price = $attribute = $product = array(); 		$amount = 0; 		foreach($_POST['cart'] as $e => $n){			$product = product::data(0,0,0,0,0,$n['id']); 			if($product['status'] == 1){ 				$pid[] = $n['id']; $number[] = numeric($n['number']); $price[] = numeric($product['price']);				$attribute[] = is_array($n['attribute']) ? implode(',',$n['attribute']) : '';				$amount += numeric($product['price']) * numeric($n['number']);			}		}		if($pid){			$amount = number_format(($amount * $cms_user_info['rank_discount'] / 10),2,'.',''); 			$oid = 'ES'.date('YmdHis',$gmt_time).random(3,1);			$pid = implode(',',$pid); $number = implode(',',$number);$price = implode(',',$price);			$attribute = implode(STRING_DELIMITED,$attribute);			$sql = "INSERT INTO `{$DB['prefix']}order` (`lang`,`oid`,`uid`,`pid`,`number`,`price`,`amount`,`attribute`,`status`,`dispatching`,`waybill`,`freight`,`consignee`,`email`,`address`,`zipcode`,`tel`,`mobile`,`building`,`besttime`,`message`,`reply`,`addtime`) VALUES (";			$sql .= "'".LANG."','{$oid}','".USER_ID."','{$pid}','{$number}','{$price}','{$amount}','{$attribute}',0,0,'',0,'','','','','','','','','','',{$gmt_time})";			if($db->execute($sql)){				$pid = $db->get_last_id();				shopping::del_cart(0,true); 				member::transaction($oid,USER_ID,4,$amount,1,$language['page']['log_info']); 				msgbox('','member/checkout.php?id='.$pid); 			} else {				msgbox($language['common']['failed'],'cart.php');			}		} else {			msgbox($language['page']['cart_null'],'cart.php'); 		}	} else {		msgbox($language['page']['not_logged'],$config['url'].'member/login.php?goto='.base64_encode($_SERVER['REQUEST_URI'])); 	}}is_numeric($_GET['del']) && shopping::del_cart($_GET['del']) && msgbox('','cart.php');'all' == $_GET['del'] && shopping::del_cart(0,true) && msgbox('','cart.php');$mycms['cart']['data'] = shopping::get_cart_data();$mycms['cart']['discount'] = USER_LOGIN ? $cms_user_info['rank_discount'] : 10;$mycms['cart']['amount_total'] = 0;foreach($mycms['cart']['data'] as $n){	$mycms['cart']['amount_total'] += numeric($n['price']);}$mycms['cart']['amount_total'] = number_format($mycms['cart']['amount_total'],2,'.','');$mycms['cart']['amount_discount'] = $mycms['cart']['discount'] < 10 ? number_format(($mycms['cart']['amount_total']*$mycms['cart']['discount'] /10),2,'.','') : $mycms['cart']['amount_total'];require_once(CMSINC.'/include/footer.php');