<?phprequire_once('../inc/include/globals.php');require_once(CMSINC.'/config/admin.config.php');$PHP_SELF == 'header.php' && die('Access Denied.');session_start(); include_once(CMSINC.'/tools/smarty/Smarty.class.php');$MYCMS = new Smarty();$MYCMS->caching = false; $MYCMS->force_compile = false; $MYCMS->cache_lifetime = 0; $MYCMS->template_dir = array(CMSINC.'/templates/manage/'); $MYCMS->compile_dir = CMSINC.'/tmp/translation_manage/'; $MYCMS->cache_dir  = CMSINC.'/tmp/cache_manage/'; $MYCMS->left_delimiter = '{:'; $MYCMS->right_delimiter = ':}'; if($config['template']['auto_clear_caching'] == 1 && (isset($_GET['action']) || !empty($_POST))){	$MYCMS->cache_dir  = CMSINC.'/tmp/cache_frontend/'; 	$MYCMS->clearAllCache();}function __autoload($class){	$cls = CMSINC.'/class/'.$class.'.class.php';	$lib = CMSINC.'/lib/'.$class.'.lib.php';	(is_file($cls) && require($cls)) or (is_file($lib) && require($lib));}if(function_exists('__autoload')){ 	spl_autoload_register('__autoload'); }define('ADMIN_PATH',CMSROOT.'/'.$config['admin_dir']);$lang_path = CMSINC.'/language/manage/chinese_simplified/';$language['common'] = $language['page'] = array(); $cl = $lang_path.'common.lang.php';is_file($cl) && require_once($cl);$dl = rtrim($lang_path.$PHP_SELF,'php').'lang.php';is_file($dl) && require_once($dl); require_once(CMSINC.'/config/file.config.php');if(!defined('FULL_ACCESS')){ 	$gotopage = ($PHP_SELF != 'index.php' && !empty($_SERVER['REQUEST_URI'])) ? 'login.php?goto='.rawurlencode($_SERVER['REQUEST_URI']) : 'login.php';	switch(admin::purview()){		case 9 : break; 		case 0 : admin::logout(); msgbox($language['common']['not_exist'],$gotopage); break; 		case 1 : msgbox($language['common']['insufficient_privileges'],'./'); break; 		case 2 : admin::logout(); msgbox($language['common']['offline'],$gotopage); break; 		case 3 : msgbox('',$gotopage); break; 		default : die('Undefined Operation.'); break; 	}}$menu = array();foreach($admin_file as $i => &$n){	if($n['attribute'][0] == 1){		$menu[$i] = $n;	}	unset($menu[$i]['submenu']); 	foreach($n['submenu'] as $i2 => &$n2){		$f_n = parse_url($n2[3]);		$f_n = basename($f_n['path']); 		if($n['attribute'][0] == 1 && $n2[0] == 1){ 			switch($PHP_SELF){				case $f_n : $n2['current'] = true; break; 				case 'article_update.php' : $f_n == 'article_manage.php' && $n2['current'] = true; break; 				case 'channel_update.php' : $f_n == 'channel_manage.php' && $n2['current'] = true; break;			//	case 'fields_manage.php' : $f_n == 'channel_manage.php' && $n2['current'] = true; break;				case 'category_update.php' : $f_n == 'category_manage.php' && $n2['current'] = true; break;				case 'product_update.php' : $f_n == 'product_manage.php' && $n2['current'] = true; break;				case 'picture_update.php' : $f_n == 'picture_manage.php' && $n2['current'] = true; break;				case 'download_update.php' : $f_n == 'download_manage.php' && $n2['current'] = true; break;				case 'member_update.php' : $f_n == 'member_manage.php' && $n2['current'] = true; break;				case 'links_update.php' : $f_n == 'links_manage.php' && $n2['current'] = true; break;				case 'admin_update.php' : $f_n == 'admin_manage.php' && $n2['current'] = true; break;				case 'guestbook_reply.php' : $f_n == 'guestbook_manage.php' && $n2['current'] = true; break;				case 'ad_update.php' : $f_n == 'ad_manage.php' && $n2['current'] = true; break;				case 'shop_order_update.php' : $f_n == 'shop_order_manage.php' && $n2['current'] = true; break;				default : $n2['current'] = false; break;			}			(($n2[4]==2 || $n2[4]==3) && file_exists($n2[3])) && $menu[$i]['submenu'][] = $n2;		} elseif ($PHP_SELF == $f_n){			msgbox($language['common']['page_off'],'BACK'); 		}	}}$mycms['menu'] = $menu; unset($n,$f_n,$menu,$i,$n2,$i2); $mycms['title_lang'] = $config['lang_total'] > 1 ? ' ('.(empty($web['name']) ? $language['common']['not_set'] : $web['name']) .')' : NULL;$opp_info = admin::opp_info();function  fieldstypes($fieldstype){			switch ($fieldstype) {			case 'varchar':				$fieldstype= '中小型文本'; 				break;			case 'text':				$fieldstype= '大型文本(编辑器)'; 				break;			case 'int':				$fieldstype= '整数'; 				break;			case 'decimal':				$fieldstype= '货币'; 				break;			case 'time':				$fieldstype= '时间'; 				break;			case 'files':				$fieldstype= '单个附件'; 				break;			case 'fileall':				$fieldstype= '多个附件'; 				break;			case 'select':				$fieldstype= '单选菜单'; 				break;			case 'checkbox':				$fieldstype= '多选菜单'; 				break;	}	return $fieldstype;}function getCLassTable($channelID){	global $DB,$modle;	$dbs = new db();	 $modles=$dbs->query("SELECT * FROM `{$DB['prefix']}channel` WHERE `id` = ".$channelID);		switch ($modles[0]['module']) {			case 'MO001x':				$modle= 'article'; 				break;			case 'MO002x':				$modle= 'product'; 				break;			case 'MO003x':				$modle= 'picture'; 				break;			case 'MO004x':				$modle= 'download'; 				break;			case 'MO005x':				$modle= 'recruitment'; 				break;				}		return $modle;}function fieldsinfo(){		global $DB,$modle,$mycms,$db,$_GET;				$GetUPchannleID=$db->query("SELECT id FROM `{$DB['prefix']}channel` where `id`=(SELECT `UpchannelID` FROM `{$DB['prefix']}channel` where `id`={$mycms['channelID']} )",1);		if($GetUPchannleID['id']!=0){		$fieldswhere=" fieldshow=1 and channelID in ({$mycms['channelID']},{$GetUPchannleID['id']})";		}else{		$fieldswhere=" fieldshow=1 and channelID=".$mycms['channelID'];		}		$v=$db->query("SELECT * FROM `{$DB['prefix']}fields` WHERE ".$fieldswhere." order by  fieldorder DESC,fid");		if($v){		$tablename=getCLassTable($mycms['channelID']);		if(is_numeric($_GET['id'])){			$c=$db->query("SELECT * FROM `{$DB['prefix']}".$tablename."_field` WHERE aid=".$_GET['id'],1);		}		foreach($v as $f){						switch ($f['fieldstype']){				case 'varchar':					if($f['fieldslong']>255){						$t='<textarea name="'.$f['fields'].'" style="width:300px; height:50px;" class="int">'.$c[$f['fields']].'</textarea>';					}else{						$t='<input name="'.$f['fields'].'" type="text" class="int" value="'.$c[$f['fields']].'"  style="width:300px;"/>  最多'.$f['fieldslong'].'个字';					}				break;				case 'text':					$t='<script type="text/javascript">$(function(){CKEDITOR.replace(\''.$f['fields'].'\');});</script>';					$t.='<textarea name="'.$f['fields'].'" id="'.$f['fields'].'"';                    $t.='" style="width:400px;height:150px;">'.$c[$f['fields']].'</textarea>';				break;				case 'int':					$t='<input name="'.$f['fields'].'" type="text" class="int" value="'.$c[$f['fields']].'" /> 请输入整数格式，可为负数';				break;				case 'decimal':					$t='<input name="'.$f['fields'].'" type="text" class="int" value="'.$c[$f['fields']].'" />  请输入货币格式，如2.03';				break;				case 'time':					if($c[$f['fields']]!=''){$time=date('Y-m-d H:i',$c[$f['fields']]);}else{$time=date('Y-m-d H:i');}					$t='<input name="'.$f['fields'].'" type="text" class="int" value="'.$time.'" onClick="WdatePicker({dateFmt:';$t.="'yyyy-MM-dd HH:mm'";$t.='})" />';				break;			}			$ccc.= '<tr><td class="name">'.$f['fieldsname'].'：</td><td>'.$t.'</td><td class="field">{:$a[\'fieldsinfo_'.$f['fields'].'\']:}</td></tr>'; 		}		return $ccc;		}else{		return;			}	}function Sortchannel($id=0){		global $db,$DB,$language,$mycms,$_GET;$mychannel = $db->query("SELECT * FROM `{$DB['prefix']}channel` WHERE `module` != '0' && `module` = 'MO001x' && `lang` = '".LANG."' && `UpChannelID` =".$id." ORDER BY `sort` ASC");			foreach($mychannel as $m){				$substr='';				for($i=0;$i<$m['level'];$i++){					$substr.="&nbsp;&nbsp;&nbsp;&nbsp;";				}				$_GET['id']==0 ? $getID="" : $getID="&id=".$_GET['id'];				$id ==0 ? $substrs='': $substrs=$substr.'├&nbsp;';		$mycms['article']['channel_text'] .= $_GET['channel'] != $m['id'] ? '<option value="article_update.php?channel='.$m['id'].$getID.'">'.$substrs.$m['title'].'</option>' : '<option selected="selected" value="">'.$substrs.$m['title'].'</option>';		Sortchannel($m['id']);	}}