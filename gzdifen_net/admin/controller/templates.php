<?phpout();if($_GET['editfile']!=""){if ( !( $fp = fopen( iconv('UTF-8','GB2312',$_GET['editfile']),"rb") ) ){exit( "不能打开文件".$_GET['editfile'] );}$data = fread( $fp,filesize( iconv('UTF-8','GB2312',$_GET['editfile']) ) );$file_name= $_GET['file'];$content= str_replace("textarea>","textarea＞",$data);fclose( $fp );}function getSize($file){if ($file<1024 ){return $_obfuscate_2gg." Byte";}if ( 1024 <=$file&&$file<1048576 ){return number_format($file/ 1024,3 )." KB";}if ( 1048576 <=$file&&$file<1073741824 ){return number_format($file/ 1024 * 1024,3 )." M";}if ( 1073741824 <=$file){return number_format($file/ 1024 * 1024 * 1024,3 )." G";}}$CurrentPath = $_GET['path'] ?$_GET['path'] : false;if ( $CurrentPath === false ){$CurrentPath = "../templates/".$skin_dir;}$fso = @opendir( $CurrentPath );while ( false !== ( $file = @readdir( $fso ) ) ){$fullpath = "{$CurrentPath}/{$file}";$is_dir = @is_dir( $fullpath );if ( $is_dir == "1"){if ( $file != ".."&&$file != "."){$PHPCMS_templates_dir.= "  <li><img src=\"themes/default/images/tree/dir.gif\"> <a href=\"?controller=templates&trajectory=";if($_GET['path']!=""){$PHPCMS_templates_dir.=$_GET['path'];}else{$PHPCMS_templates_dir.=$CurrentPath;}$PHPCMS_templates_dir.="&path=".$CurrentPath."/".$file.( "\"  target=\"navTab\"><span>".$file."</span></a></li>\n");}else if ( !( $file == "..") &&!( realpath( $CurrentPath."/".$file ) == realpath( "../templates/default") ) ){$PHPCMS_templates_dir.= "<li><img src=\"themes/default/images/tree/dir2.gif\"> <a href=\"?controller=templates&path=".$_GET['trajectory']."\"target=\"navTab\"><span>上级目录</span></a></li>";}}}@closedir( $fso );$fso = @opendir( $CurrentPath );$num=0;while ( $file = @readdir( $fso ) ){$fullpath = "{$CurrentPath}/{$file}";$is_dir = @is_dir( $fullpath );if ( $is_dir == "0"){$num+=1;$size = @filesize( "{$CurrentPath}/{$file}");$size = @getsize( $size );$lastsave = @date( "Y-n-d H:i:s",@filemtime( "{$CurrentPath}/{$file}") );$PHPCMS_templates.= "<tr>\n";$PHPCMS_templates.= "<td>".$num."</td><td>◇ ".iconv('GB2312','UTF-8',$file)."</td>\n";$PHPCMS_templates.= "<td align=\"center\">".$lastsave."</td>\n";$PHPCMS_templates.= "<td align=\"center\">".$size."</td>\n";$file_types = explode( ".",$file );$file_type = $file_types[count( $file_types ) -1];if ( strtolower( $file_type ) != "jpg"&strtolower( $file_type ) != "gif"&strtolower( $file_type ) != "bmp"&strtolower( $file_type ) != "png"){$PHPCMS_templates.= "<td align=\"center\"><a  target=\"dialog\" href=\"?controller=templates&action=edit&editfile=".$CurrentPath."/".iconv('GB2312','UTF-8',$file)."&file=".iconv('GB2312','UTF-8',$file)."\">编辑</a></td>\n";}else{$PHPCMS_templates.= "<td align=\"center\"><a href=\"".$CurrentPath."/".$file."\" target=\"_blank\">观看</a></td>\n";}$PHPCMS_templates.= "</tr>\n";}}@closedir( $fso );?>