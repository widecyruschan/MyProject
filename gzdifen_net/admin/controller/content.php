<?php$id=verify_id($_GET['id']);$cid=verify_id($_GET['columns']);$module=str_check($_GET['module']);$column=verify_id($_GET['column']);$orderField=str_check($_POST['orderField']);$province=str_check($_POST['province']);$keywords=str_check($_POST['keywords']);if(preg_match("/^[0-9]+$/i",$module)){$db->query( "select * from {$DB_dbprefix}module WHERE id=$module ");if ($db->next_record()){$module_id                = $db->Record['id'];$module_name              = $db->Record['name'];$module_alias             = $db->Record['alias'];$module_content           = unserialize($db->Record['content']);$module_serialize_content = $db->Record['content'];}}else{$db->query( "select * from {$DB_dbprefix}columns WHERE id=$id ");if ($db->next_record()){$columns_id                = $db->Record['id'];$columns_bid               = $db->Record['bid'];$columns_module            = $db->Record['module'];$columns_templates         = $db->Record['templates'];$columns_title             = $db->Record['title'];$columns_subtitle          = $db->Record['subtitle'];$columns_hide              = $db->Record['hide'];$columns_description       = $db->Record['description'];$columns_keywords          = $db->Record['keywords'];$columns_time              = $db->Record['title'];$columns_permute           = $db->Record['permute'];$columns_content           = $db->Record['content'];$columns_url               = $db->Record['url'];}}if($action=="add"){if(is_array($module_content)) for($i=0;$i<count($module_content);$i++) {$module_content_td.="<tr>\r\n <td valign=\"top\"><label>".$module_content[$i]["name"].":</label></td>\r\n<td>";if($module_content[$i]["required"]=="1"){$required="required";}if($module_content[$i]["type"]=="text"){$module_content_td.='<input  name="z_'.$module_content[$i]["alias"].'" type="text"  size="45" class="'.$required.'" />';}elseif($module_content[$i]["type"]=="upload"){$module_content_td.='<input name="z_'.$module_content[$i]["alias"].'" type="text"   size="45" /></td></tr><tr><td></td><td><iframe src="?controller=upload&immediate=1&name=z_'.$module_content[$i]["alias"].'&action=add" frameborder="0" scrolling="no" width="260" height="23"></iframe>';}elseif($module_content[$i]["type"]=="editor"){$module_content_td.='<textarea id="textarea"  name="z_'.$module_content[$i]["alias"].'" class="editor {background:\'url(themes/default/images/logo_light.png)no-repeat  center\',loadCSS:\''.$web_dir.$editor_style.'\',upLinkUrl:\'?model=upload\',upImgUrl:\'?model=upload\',upFlashUrl:\'?model=upload\',upMediaUrl:\'?model=upload\'}"  style="width:400px; height:300px">'.$module_content[$i]["content"].'</textarea>';}elseif($module_content[$i]["type"]=="time"){$module_content_td.='<input  name="z_'.$module_content[$i]["alias"].'" type="text" size="35" class="date" /><a class="inputDateButton" href="javascript:void(0)">选择</a>';}elseif($module_content[$i]["type"]=="digit"){$module_content_td.='<input  name="z_'.$module_content[$i]["alias"].'" type="text" size="45" class="digit '.$required.'" />';}elseif($module_content[$i]["type"]=="url"){$module_content_td.='<input  name="z_'.$module_content[$i]["alias"].'" type="text" size="45" class="url '.$required.'" />';}elseif($module_content[$i]["type"]=="email"){$module_content_td.='<input  name="z_'.$module_content[$i]["alias"].'" type="text" size="45" class="email '.$required.'" />';}elseif($module_content[$i]["type"]=="multiple"){$module_content_td.='<textarea name="z_'.$module_content[$i]["alias"].'"  rows="5" cols="50" class="'.$required.'">'.$module_content[$i]["content"].'</textarea>';}$module_content_td.="</td>\r\n</tr>\r\n\r\n";}}if($action=="edit"){$result=$db->query( "select * from {$DB_dbprefix}z_{$module_alias} WHERE bid=$id ");$content=mysql_fetch_row($result);foreach($module_content as $key=>$value){$module_content[$key]['required']  = $module_content[$key]["required"];$module_content[$key]['type']      = $module_content[$key]["type"];$module_content[$key]['name']      = $module_content[$key]["name"];$module_content[$key]['alias']     = $module_content[$key]["alias"];$module_content[$key]['text']      = $module_content[$key]["text"];$module_content[$key]['content']   = $content[$key+2];}$db->query( "select * from {$DB_dbprefix}content WHERE id=$id ");if ($db->next_record()){$id          = $db->Record['id'];$hits        = $db->Record['hits'];$cid         = $db->Record['cid'];$hide        = $db->Record['hide'];$title       = $db->Record['title'];$subtitle    = $db->Record['subtitle'];$keywords    = $db->Record['keywords'];$description = $db->Record['description'];$time        = $db->Record['time'];$permute     = $db->Record['permute'];}if(is_array($module_content)) for($i=0;$i<count($module_content);$i++) {$module_content_td.="<tr>\r\n <td valign=\"top\"><label>".$module_content[$i]["name"].":</label></td>\r\n<td>";if($module_content[$i]["required"]=="1"){$required="required";}if($module_content[$i]["type"]=="text"){$module_content_td.='<input  name="z_'.$module_content[$i]["alias"].'" type="text"  size="45" class="'.$required.'" value="'.$module_content[$i]["content"].'"/>';}elseif($module_content[$i]["type"]=="upload"){$module_content_td.='<input name="z_'.$module_content[$i]["alias"].'" type="text" value="'.$module_content[$i]["content"].'"  size="45" /></td></tr><tr><td></td><td><iframe src="?controller=upload&immediate=1&name=z_'.$module_content[$i]["alias"].'&action=add" frameborder="0" scrolling="no" width="260" height="23"></iframe>';}elseif($module_content[$i]["type"]=="editor"){$module_content_td.='<br/><textarea id="textarea"  name="z_'.$module_content[$i]["alias"].'"  class="editor {background:\'url(themes/default/images/logo_light.png)no-repeat  center\',loadCSS:\''.$web_dir.$editor_style.'\',upLinkUrl:\'?model=upload\',upImgUrl:\'?model=upload\',upFlashUrl:\'?model=upload\',upMediaUrl:\'?model=upload\'}" style="width:400px; height:300px">'.$module_content[$i]["content"].'</textarea>';}elseif($module_content[$i]["type"]=="time"){$module_content_td.='<input  name="z_'.$module_content[$i]["alias"].'" type="text" size="35" class="date" value="'.$module_content[$i]["content"].'"/><a class="inputDateButton" href="javascript:void(0)">选择</a>';}elseif($module_content[$i]["type"]=="digit"){$module_content_td.='<input  name="z_'.$module_content[$i]["alias"].'" type="text" size="45" class="digit '.$required.'" value="'.$module_content[$i]["content"].'"/>';}elseif($module_content[$i]["type"]=="url"){$module_content_td.='<input  name="z_'.$module_content[$i]["alias"].'" type="text" size="45" class="url '.$required.'" value="'.$module_content[$i]["content"].'"/>';}elseif($module_content[$i]["type"]=="email"){$module_content_td.='<input  name="z_'.$module_content[$i]["alias"].'" type="text" size="45" class="email '.$required.'" value="'.$module_content[$i]["content"].'"/>';}elseif($module_content[$i]["type"]=="multiple"){$module_content_td.='<textarea name="z_'.$module_content[$i]["alias"].'"  rows="5" cols="50" class="'.$required.'">'.$module_content[$i]["content"].'</textarea>';}$module_content_td.="</td>\r\n</tr>\r\n\r\n";}}if($action==""){if($province!=""and $keywords!=""){$where="and `".$province."` like '%".$keywords."%'";}if($orderField){$orderField="".$orderField." asc";}else{$orderField="`permute` DESC,`id` DESC";}if($_POST['numPerPage']==""){$numPerPage=20;}else{$numPerPage=$_POST['numPerPage'];}if($_POST['pageNum']==""){$pageNum=1;}else{$pageNum=$_POST['pageNum'];}if($pageNum==0){$offset = 1;}else{$offset = ( $pageNum -1 ) * $numPerPage;}$execc = "SELECT id FROM  `{$DB_dbprefix}content` WHERE cid=$id";$strSql="SELECT * FROM  `{$DB_dbprefix}content` WHERE cid=$id $where ORDER BY   $orderField  LIMIT {$offset},{$numPerPage}";$resultc = mysql_query( $execc );$intNum = mysql_num_rows( $resultc );$db->query( $strSql );while ($db->next_record()){$PHPCMS_content .= "<tr target=\"id\" rel=\"".$db->Record['id']."\">				    <td><input name=\"ids\" value=\"".$db->Record['id']."\" type=\"checkbox\"></td>					<td>".$db->Record['id']."</td>					<td>".$db->Record['title']."</td>					<td>".$db->Record['description']."</td>					<td>".$db->Record['subtitle']."</td>                    <td>".date("Y-m-d H:i:s",$db->Record['time'])."</td>                    <td>".$db->Record['permute']."</td>				    </tr>";}}?>