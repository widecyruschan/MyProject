<?phpinclude( "inc/header.php" );login_check();$class_arr=array();$sql = "select * from `{$DB_dbprefix}columns` order by columnswith desc, id Desc";$query = $db -> query($sql);while($row=mysql_fetch_assoc($query)){              $class_arr[] = array($row['id'],$row['columnsname'],$row['bid'],$row['sort']);		}if ( $webmode == "php" ){	admin_showerr( "<li>站点生成模式必须是PHP以外的模式才可以使用生成功能</li>", "Admin_Settings.php", 0 );}echo "<TABLE width=\"98%\" border=\"1\" align=\"center\" cellpadding=\"5\" cellspacing=\"0\" class=\"table\">\r\n\r\n    <TR>\r\n      <TD><a href=\"Admin_HtmlIndex.php\">生成首页</a> ｜ <a href=\"Admin_HtmlType.php\">生成栏目</a> ｜ <a href=\"Admin_HtmlContent.php\">生成文档</a> ｜ <a href=\"Admin_SiteMap.php\">生成网站地图</a></TD>\r\n    </TR>\r\n</TABLE>\r\n<br>\r\n";if ( !isset( $_GET['Action'] ) ){	echo "<TABLE class=\"table\" cellSpacing=\"0\" cellPadding=\"5\" width=\"98%\" align=\"center\" border=\"1\">\r\n  <form action=\"Admin_HtmlType.php?Action=RefreshClass\" method=\"post\">\r\n    <TR>\r\n      <TD colSpan=3>栏目发布</TD>\r\n    </TR>\r\n    <TR>\r\n      <TD width=\"20%\" height=\"32\" align=\"right\" class=\"hback\">发布全部栏目：</TD>\r\n      <TD colspan=\"2\" class=\"hback\"><input type=\"submit\" name=\"Submit\" value=\"开始发布\"></TD>\r\n    </TR>\r\n    <TR>\r\n      <TD align=\"right\" class=\"hback\">选择栏目发布：</TD>\r\n      <TD width=\"21%\" class=\"hback\"><select name=\"ClassID[]\" size=\"10\" multiple style=\"width:260px\">\r\n                                     ";	dafenglei_select(0,0,0);	echo "  \t\t\t\t\t\t\t\t\t</select></TD>\r\n      <TD class=\"hback\"><p>1、您可以按住CTRL或SHIFT同时选择多个栏目一起发布</p>\r\n        <p>2、也可以选择一个栏目</p>\r\n        <p>4、如果需要生成的栏目较多，建议采用分类生成</p>\r\n      <p>5、注意在生成过程中，请勿手动刷新此页面</p></TD>\r\n    </TR>\r\n    <TR>\r\n      <TD height=\"32\" class=\"hback\">&nbsp;</TD>\r\n      <TD colspan=\"2\" class=\"hback\"><input type=\"submit\" name=\"Submit\" value=\"开始发布\"></TD>\r\n    </TR>\r\n  </form>\r\n</TABLE>\r\n";}else{	echo "<script type=\"text/javascript\" src=\"../inc/ajaxrequest.js\"></script>\r\n<script type=\"text/javascript\" src=\"inc/htmljs.js\"></script>\r\n<TABLE width=\"98%\" border=\"1\" align=\"center\" cellpadding=\"5\" cellspacing=\"0\" class=\"table\">\r\n        <TR>\r\n          <TD><strong>发布进度</strong></TD>\r\n        </TR>\r\n\t\t<TR>\r\n          <TD height=32 align=\"center\"><div class=\"RefreshLen\"><span class=\"xingmu\" id=\"RefreshLenx\"></span></div></TD>\r\n        </TR>\r\n        <TR>\r\n          <TD height=32 align=\"center\">总共要生成<span id=\"ClassNum\" style=\"color:#FF0000\"></span>个栏目,已经生成<span id=\"ClassHtmlNum\" style=\"color:#FF0000\">0</span>个栏目,当前生成<span id=\"ClassName\" style=\"color:#FF0000\"></span>栏目,该栏目共有<span id=\"ClassPageNum\" style=\"color:#FF0000\"></span>个分页,已生成<span id=\"ClassPage\" style=\"color:#FF0000\"></span>个分页</TD>\r\n        </TR>\r\n\t\t<TR>\r\n          <TD height=32 align=\"center\"><a href=\"Admin_Htmltype.php\">返回</a></TD>\r\n        </TR>\r\n  </TABLE>\r\n";	if ( isset( $_POST['ClassID'] ) )	{		$chid = implode( ",", $_POST['ClassID'] );		$sql = "SELECT * FROM {$DB_dbprefix}columns WHERE id in (".$chid.")";	}	else	{		$sql = "SELECT * FROM {$DB_dbprefix}columns";	}	$resultc = $db->query( $sql );	$intNum = mysql_num_rows( $resultc );	$i = 0;	while ( $db->next_record( ) )	{		$i += 1;		echo "<script language=\"JavaScript\">\r\ndocument.getElementById(\"RefreshLenx\").style.width = (";		echo $i / $intNum;		echo ")*100+\"%\";\r\ndocument.getElementById(\"RefreshLenx\").innerHTML = (";		echo $i / $intNum;		echo ")*100+\"%\";\r\ndocument.getElementById(\"ClassName\").innerHTML = \"";		echo $db->Record['columnsname'];		echo "\";\r\ndocument.getElementById(\"ClassNum\").innerHTML = ";		echo $intNum;		echo ";\r\ndocument.getElementById(\"ClassHtmlNum\").innerHTML = ";		echo $i;		echo ";\r\ndocument.getElementById(\"ClassPageNum\").innerHTML = 1;\r\ndocument.getElementById(\"ClassPage\").innerHTML = 1;\r\n\r\nvar Url=\"Admin_HtmlTypeAjax.php?id=";		echo $db->Record['id'];		echo "&PB_page=1";		echo "\";\r\nclasshtml(Url);\r\n</script>\r\n";	}	addlog( "生成栏目", $_SESSION['user_name'] );}echo "</BODY>\r\n</HTML>";?>