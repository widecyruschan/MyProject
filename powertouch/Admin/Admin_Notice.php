<?phpfunction add( ){				echo "<script language=\"javascript\" src=\"inc/js.js\"></script>\r\n<table width=\"98%\" border=\"1\" align=\"center\" cellpadding=\"5\" cellspacing=\"0\" class=\"table\">\r\n<form action=\"Admin_Notice.php?Action=addsever\" method=\"post\" onSubmit=\"return Validator.Validate(this,3)\">\r\n  <tr>\r\n   <td width=\"15%\" align=\"right\">公告标题：</td>\r\n   <td width=\"75%\"><input name=\"title\" type=\"text\" size=\"47\" dataType=\"Require\" msg=\"请填写公告标题\"/></td>\r\n  </tr>\r\n  <tr>\r\n    <td align=\"right\">公告内容：</td>\r\n    <td>";?><textarea cols="80" id="editor_kama" name="content" rows="5" cols="10"></textarea><script type="text/javascript">//<![CDATA[CKEDITOR.replace('content', { "filebrowserBrowseUrl": "module\/ckfinder\/ckfinder.html", "filebrowserImageBrowseUrl": "module\/ckfinder\/ckfinder.html?type=Images", "filebrowserFlashBrowseUrl": "module\/ckfinder\/ckfinder.html?type=Flash", "filebrowserUploadUrl": "module\/ckfinder\/core\/connector\/php\/connector.php?command=QuickUpload&type=Files", "filebrowserImageUploadUrl": "module\/ckfinder\/core\/connector\/php\/connector.php?command=QuickUpload&type=Images", "filebrowserFlashUploadUrl": "module\/ckfinder\/core\/connector\/php\/connector.php?command=QuickUpload&type=Flash" });//]]></script><?php				echo "</td>\r\n  </tr>\r\n  <tr>\r\n    <td>&nbsp;</td>\r\n    <td><input type=\"submit\" name=\"Submit_add\" value=\"添加公告\" /></td>\r\n  </tr>\r\n</form>\r\n</table>\r\n";}function edit( ){				global $db,$DB_dbprefix;				$db->query( "select * from {$DB_dbprefix}notice WHERE id=".$_GET['id'] );				if ( $db->next_record( ) )				{								echo "<script language=\"javascript\" src=\"inc/js.js\"></script>\r\n<table width=\"98%\" border=\"1\" align=\"center\" cellpadding=\"5\" cellspacing=\"0\" class=\"table\">\r\n  <form action=\"Admin_Notice.php?Action=editsever\" method=\"post\" onSubmit=\"return Validator.Validate(this,3)\">\r\n    <tr>\r\n      <td width=\"15%\" align=\"right\">公告标题：</td>\r\n      <td width=\"75%\">\r\n      <input name=\"id\" type=\"hidden\" value=\"";								echo $db->Record['id'];								echo "\" />\r\n      <input name=\"title\" type=\"text\" value=\"";								echo $db->Record['title'];								echo "\" size=\"47\" dataType=\"Require\" msg=\"请填写公告标题\"/></td>\r\n    </tr>\r\n    <tr>\r\n      <td align=\"right\">公告内容：</td>\r\n      <td>";?><textarea cols="80" id="editor_kama" name="content" rows="5" cols="10"><?=$db->Record['content']?></textarea><script type="text/javascript">//<![CDATA[CKEDITOR.replace('content', { "filebrowserBrowseUrl": "module\/ckfinder\/ckfinder.html", "filebrowserImageBrowseUrl": "module\/ckfinder\/ckfinder.html?type=Images", "filebrowserFlashBrowseUrl": "module\/ckfinder\/ckfinder.html?type=Flash", "filebrowserUploadUrl": "module\/ckfinder\/core\/connector\/php\/connector.php?command=QuickUpload&type=Files", "filebrowserImageUploadUrl": "module\/ckfinder\/core\/connector\/php\/connector.php?command=QuickUpload&type=Images", "filebrowserFlashUploadUrl": "module\/ckfinder\/core\/connector\/php\/connector.php?command=QuickUpload&type=Flash" });//]]></script><?php								echo "</td>\r\n    </tr>\r\n    <tr>\r\n      <td>&nbsp;</td>\r\n      <td><input type=\"submit\" name=\"Submit_edit\" value=\"修改公告\" /></td>\r\n    </tr>\r\n  </form>\r\n</table>\r\n";				}}include( "inc/header.php" );login_check();echo "\r\n<body>\r\n<script type=\"text/javascript\" src=\"module/ckeditor/ckeditor.js\"></script><table width=\"98%\" border=\"1\" align=\"center\" cellpadding=\"5\" cellspacing=\"0\" class=\"table\">\r\n  <tr>\r\n    <td><a href=\"Admin_Notice.php\">公告管理首页</a> ｜ <a href=\"Admin_Notice.php?Action=add\">添加新的公告</a></td>\r\n  </tr>\r\n</table>\r\n<br>\r\n";switch ( $_GET['Action'] ){case "add" :				add( );				break;case "addsever" :				if ( function_exists( "date_default_timezone_set" ) )				{								date_default_timezone_set( "Hongkong" );				}				@$GLOBALS['_POST'][time] = date( "Y-m-d H-i-s" );				$db->query( "INSERT INTO {$DB_dbprefix}notice (title,content,time) \r\n\t\tVALUES ('".$_POST['title']."','{$_POST['content']}','{$_POST['time']}')" );				addlog( "添加公告", $_SESSION['user_name'] );				admin_showerr( "<li>公告添加成功</li>", "Admin_Notice.php", 1 );				break;case "edit" :				edit( );				break;case "editsever" :				$db->query( "UPDATE {$DB_dbprefix}notice SET title='".$_POST['title']."',\r\n\t\tcontent='{$_POST['content']}' WHERE id={$_POST['id']}" );				addlog( "修改公告", $_SESSION['user_name'] );				admin_showerr( "<li>公告修改成功</li>", "Admin_Notice.php", 1 );				break;case "del" :				$db->query( "DELETE FROM {$DB_dbprefix}notice WHERE id=".$_GET['id'] );				addlog( "删除公告", $_SESSION['user_name'] );				admin_showerr( "<li>公告删除成功</li>", "Admin_Notice.php", 1 );				break;default :				$db->query( "SELECT * FROM {$DB_dbprefix}notice" );				echo "<table width=\"98%\" border=\"1\" align=\"center\" cellpadding=\"5\" cellspacing=\"0\" class=\"table\">\r\n  <tr>\r\n    <td width=\"5%\" align=\"center\"><strong>ID</strong></td>\r\n    <td align=\"center\"><strong>标题</strong></td>\r\n    <td width=\"18%\" align=\"center\"><strong>发布时间</strong></td>\r\n    <td width=\"15%\" align=\"center\"><strong>操作</strong></td>\r\n  </tr>\r\n";				while ( $db->next_record( ) )				{								echo "<form action=\"Admin_Notice.php\" method=\"post\" name=\"form";								echo $db->Record['id'];								echo "\">\r\n  <tr>\r\n    <td width=\"4%\" align=\"center\">";								echo $db->Record['id'];								echo "</td>\r\n    <td>";								echo $db->Record['title'];								echo "</td>\r\n    <td>";								echo $db->Record['time'];								echo "</td>\r\n    <td align=\"center\"><a href=\"Admin_Notice.php?Action=edit&id=";								echo $db->Record['id'];								echo "\">编辑</a> ｜\r\n    <a href=\"Admin_Notice.php?Action=del&id=";								echo $db->Record['id'];								echo "\">删除</a></td>\r\n  </tr>\r\n</form>\r\n";				}}echo "</table>\r\n</body>\r\n</html>";?>