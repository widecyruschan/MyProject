<?php@header("Content-Type:text/html;charset=utf-8");include( "./inc/header.php" );session_start( );ob_start( );if(empty($_POST['submit'])) {	$location=Location('login','');	define('IN' , true);	$tpl_refresh_time =  $skincache;	$tpl_default_dir =  "../templates/".$skindir."/member";	$t = new template;	$t->tpl_default_dir = $tpl_default_dir;	$t->tpl_refresh_time = $tpl_refresh_time;	include $t->tpl('login');	$_SESSION['refer']=$_SERVER['HTTP_REFERER'];//来路地址} else {	if($uc_switch=='0')	{				$db->query( "SELECT * FROM {$DB_dbprefix}member where user='".str_check($_POST['username'])."' and password='".md5($_POST['password'])."'");		if ( 0 < $db->next_record( ) )        {		$_SESSION['session_time']=time();		$_SESSION['user_name'] = $db->Record["user"];		$_SESSION['uid'] = $db->Record["id"];		echo $_SESSION['uid'];		echo '登录成功'.$ucsynlogin.'<br><a href="index.php">继续</a>　<a href="'.$_SESSION['refer'].'">返回上一页</a>';		}else{		echo '<script language=javascript>alert(\'账号名或密码不正确,请重新输入!\');history.go(-1)</script>';	    }	}else	{	//通过接口判断登录帐号的正确性，返回值为数组	list($uid, $username, $password, $email) = uc_user_login($_POST['username'], $_POST['password']);	if($uid > 0) {		$strSql="SELECT id FROM {$DB_dbprefix}member WHERE id=$uid";        $db->query($strSql);	    if(!$db->next_record())		{			//判断用户是否存在于用户表，不存在则跳转到激活页面			$auth = rawurlencode(uc_authcode("$username\t".time(), 'ENCODE'));			$_SESSION['active_password'] = $_POST['password'];			echo '您需要需要激活该帐号，才能进入本应用程序<br><a href="register.php?action=activation&auth='.$auth.'">继续</a>';			exit;		}				 $_SESSION['session_time']=time();     		 $_SESSION['user_name'] = $username;		 $_SESSION['uid'] = $uid;		 		 echo $_SESSION['user_name'];		//生成同步登录的代码		$ucsynlogin = uc_user_synlogin($uid);		echo '登录成功'.$ucsynlogin.'<br><a href="index.php">继续</a>　<a href="'.$_SESSION['refer'].'">返回上一页</a>';		unset($_SESSION['refer']);//吊销来路地址				exit;	} elseif($uid == -1) {		echo '<script language=javascript>alert(\'用户不存在,或者被删除!\');history.go(-1)</script>';	} elseif($uid == -2) {		echo '<script language=javascript>alert(\'密码错误,请重新输入!\');history.go(-1)</script>';	} else {		echo '<script language=javascript>alert(\'未知错误\');history.go(-1)</script>';	}  }}?>