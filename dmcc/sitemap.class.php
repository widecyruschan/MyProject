<?php/**  +------------------------------------------------------------------------------ * SITEMAP生成类  +------------------------------------------------------------------------------	用法：载入sitemap.class.php后：	<pre class="brush:php; toolbar: true; auto-links: true;">  $stitmap = new sitemap();	$stitmap->AddItem("http://licao.so","2012-03-27T09:04:04-08:00","always","0.8");	$stitmap->Display(TRUE);</pre><br>	或：	$stitmap = new sitemap("sitemap.xml");	$stitmap->AddItem("http://licao.so","2012-03-27T09:04:04-08:00","always","0.8");	$stitmap->Display(TRUE);		或：	$stitmap = new sitemap("sitemap.xml","./sitemap/");	$stitmap->AddItem("http://licao.so","2012-03-27T09:04:04-08:00","always","0.8");	$stitmap->Display(TRUE); *   +------------------------------------------------------------------------------ */class sitemap {    protected $items = array();    protected $dir;                 //生成sitemap目录路径    protected $xmlName;             //生成sitemap文件名    public function __construct($xmlName, $dir) {        $this->dir = $dir;        $this->xmlName = $xmlName;    }    /**      +----------------------------------------------------------     * 添加siteUrl项      +----------------------------------------------------------     * @param string $loc           链接     * @param string $lastmod       更新时间     * @param string $changefreq    更新频率 "always", "hourly", "daily", "weekly", "monthly", "yearly"     * @param string $priority      级别      +----------------------------------------------------------     */    function AddItem($loc, $changefreq, $lastmod, $priority) {        $lastmod = empty($lastmod) ? date("Y-m-d") . "T" . date("H:i:s-08:00") : $lastmod;        $changefreq = empty($changefreq) ? "always" : $changefreq;        $priority = empty($priority) ? "0.8" : $priority;        $this->items[] = array('loc' => $loc, 'lastmod' => $lastmod, 'changefreq' => $changefreq, 'priority' => $priority);    }    /**      +----------------------------------------------------------     * 输出SITEMAP的XML为字符串      +----------------------------------------------------------     * @return string      +----------------------------------------------------------     */    public function Fetch() {        $map = "<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n";        $map.="<urlset	xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\r\n";        foreach ($this->items as $v) {            $map.="\t<url>\r\n";            $map.="\t\t<loc>" . $v[loc] . "</loc>\r\n";            $map.="\t\t<lastmod>" . $v[lastmod] . "</lastmod>\r\n";            $map.="\t\t<changefreq>" . $v[changefreq] . "</changefreq>\r\n";            $map.="\t\t<priority>" . $v[priority] . "</priority>\r\n";            $map.="\t</url>\r\n";        }        $map.='</urlset>';        return $map;    }    /**      +----------------------------------------------------------     * 输出SITEMAP的XML到浏览器      +----------------------------------------------------------     * @param boole $display           是否显示sitemap内容      +----------------------------------------------------------     */    public function Display($display=FALSE) {        $xml = $this->Fetch();        if ($display == TRUE) {            header("Content-Type: text/xml; charset=utf-8");            echo $xml;        }        $this->makeXml($this->dir, $this->xmlName, $xml, $display);    }    /**      +----------------------------------------------------------     * 检测目录，不存在创建目录      +----------------------------------------------------------     * @param str $dir           目录      +----------------------------------------------------------     */    function make_dir($dir) {        return is_dir($dir) or (make_dir(dirname($dir)) and @mkdir($dir, 0777));    }    /**      +----------------------------------------------------------     * 生成sitemap.xml文件      +----------------------------------------------------------     * @param str $dir           目录     * @param str $xml           sitemap文件名     * @param str $xml           sitemap内容     * @param str $display       是否在页面中显示sitemap内容      +----------------------------------------------------------     */    function makeXml($dir, $xmlName, $xml, $display) {        $dir = $dir == '' ? $_SERVER[DOCUMENT_ROOT] : $this->make_dir($dir);        $xmlName = $xmlName == '' ? $dir . "sitemap.xml" : $dir . $xmlName;        $handle = fopen($xmlName, "w");        if (!fwrite($handle, $xml)) {            if ($display == FALSE) {                die("生成文件" . $xmlName . "失败！");            }        } else {            if ($display == FALSE) {                die("生成文件" . $xmlName . "成功！");            }        }        fclose($handle);    }}?>