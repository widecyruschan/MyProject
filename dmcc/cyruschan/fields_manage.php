<?phprequire_once(dirname(__FILE__).'/header.php');$mycms['fields_show'] = true; $mycms['op_url'] = 'fields_manage.php?id='.(is_numeric($_GET['id']) ? $_GET['id'] : 0); $list = fields_list($_GET['id']);$mycms['fields_list'] = $list['fields_list']; $sql = "SELECT title FROM `{$DB['prefix']}channel` WHERE id=".$_GET['id'];$mycms['id']=$_GET['id'];$cat = $db->query($sql);$mycms['pagetitle']="[ ".$cat[0]['title']." 频 道 ] ";if(is_numeric($_GET['del'])){fields_del($_GET['del']);}function fields_list(){	global $db,$DB,$ids,$_GET;	$sql = "SELECT a.* FROM `{$DB['prefix']}fields` a LEFT JOIN `{$DB['prefix']}channel` b on a.`channelID`=b.`id` where b.`id`=".$_GET['id']."  order by a.`fid` desc";	$mycms['fields_list'] = $db->query($sql);	foreach($mycms['fields_list'] as &$n){		$n['fieldstype']=fieldstypes($n['fieldstype']);	}	return $mycms;}function fields_del($id){	global $db,$DB,$ids,$_GET;	$sql = "SELECT `channelID`,`fields` FROM `{$DB['prefix']}fields` where `fid`=".$id;	$channelID = $db->query($sql);	$TableName=getCLassTable($channelID[0]['channelID']);	$fsql="ALTER TABLE {$DB['prefix']}".$TableName."_field  DROP COLUMN ".$channelID[0]['fields'];	//getCLassTable($modle);	$dbs = new db();	if(!$dbs->execute($fsql)){msgbox("字段删除失败，请手工删除 {$DB['prefix']}".$TableName."_field 表下的".$channelID[0]['fields']."字段后重新提交",'BACK');}	else{	$result = $db->execute("DELETE FROM `{$DB['prefix']}fields` WHERE `fid`=".$id);		msgbox('字段删除成功','fields_manage.php?id='.$mycms['id']);	}}require_once(ADMIN_PATH.'/footer.php'); 